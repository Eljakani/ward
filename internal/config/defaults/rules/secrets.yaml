# Ward Default Rules â€” Secrets & Credentials
# Detects hardcoded secrets, API keys, passwords, and tokens in source code.

rules:
  - id: SECRET-001
    title: "Hardcoded password in PHP source"
    description: >
      A password appears to be hardcoded as a string literal. Hardcoded passwords
      are visible to anyone with source code access and cannot be rotated without
      a code deploy.
    severity: high
    category: Secrets
    enabled: true
    tags: [secrets, cwe-798]
    patterns:
      - type: regex
        target: php-files
        pattern: '\$password\s*=\s*[''"][a-zA-Z0-9!@#$%^&*_.]{4,}'
    remediation: |
      Use environment variables instead:
        $password = env('DB_PASSWORD');
      Or use Laravel's config system:
        $password = config('database.connections.mysql.password');
    references:
      - https://cwe.mitre.org/data/definitions/798.html

  - id: SECRET-002
    title: "Hardcoded API key or secret in PHP source"
    description: >
      A variable named api_key, api_secret, secret_key, or similar is assigned
      a string literal. These credentials should come from environment variables
      or a secrets manager.
    severity: high
    category: Secrets
    enabled: true
    tags: [secrets, cwe-798]
    patterns:
      - type: regex
        target: php-files
        pattern: '(api_key|api_secret|secret_key|access_key|private_key|app_secret)\s*[=:]\s*[''"][a-zA-Z0-9]+'
    remediation: |
      Store API keys in .env and access via env():
        $apiKey = env('SERVICE_API_KEY');
    references:
      - https://cwe.mitre.org/data/definitions/798.html

  - id: SECRET-003
    title: "AWS credentials hardcoded in source"
    description: >
      AWS access key ID or secret access key found hardcoded in PHP source.
      These credentials grant access to AWS resources and must never be committed
      to version control.
    severity: critical
    category: Secrets
    enabled: true
    tags: [secrets, aws, cwe-798]
    patterns:
      - type: regex
        target: php-files
        pattern: '(AKIA[0-9A-Z]{16}|aws_secret_access_key\s*[=:]\s*[''"][A-Za-z0-9/+=]{20,})'
    remediation: |
      Use IAM roles or environment variables for AWS credentials:
        AWS_ACCESS_KEY_ID=... in .env
        AWS_SECRET_ACCESS_KEY=... in .env
      Immediately rotate any exposed keys in the AWS console.
    references:
      - https://cwe.mitre.org/data/definitions/798.html
      - https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html

  - id: SECRET-004
    title: "Private key embedded in source"
    description: >
      A PEM-encoded private key header was found in a PHP file. Private keys
      should be stored in secure files or a vault, never inline in source code.
    severity: critical
    category: Secrets
    enabled: true
    tags: [secrets, crypto, cwe-321]
    patterns:
      - type: regex
        target: php-files
        pattern: '-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----'
    remediation: |
      Store private keys in files outside the repository or use a secrets manager.
      Reference via environment variables:
        $key = file_get_contents(env('PRIVATE_KEY_PATH'));
    references:
      - https://cwe.mitre.org/data/definitions/321.html

  - id: SECRET-005
    title: "Hardcoded JWT secret"
    description: >
      A JWT secret or signing key appears to be hardcoded. If the JWT secret
      is compromised, attackers can forge authentication tokens.
    severity: high
    category: Secrets
    enabled: true
    tags: [secrets, jwt, cwe-798]
    patterns:
      - type: regex
        target: php-files
        pattern: '(jwt_secret|jwt_key|JWT_SECRET)\s*[=:>]\s*[''"][a-zA-Z0-9!@#$%^&*_.]{8,}'
    remediation: |
      Set the JWT secret in your .env file:
        JWT_SECRET=your-secret-here
      And reference it via config:
        'secret' => env('JWT_SECRET'),
    references:
      - https://cwe.mitre.org/data/definitions/798.html

  - id: SECRET-006
    title: "Bearer token hardcoded in source"
    description: >
      A Bearer token literal was found in source code. Hardcoded tokens cannot
      be rotated and are exposed to anyone with repository access.
    severity: high
    category: Secrets
    enabled: true
    tags: [secrets, cwe-798]
    patterns:
      - type: regex
        target: php-files
        pattern: 'Bearer\s+[a-zA-Z0-9._\-]{20,}'
    remediation: |
      Store tokens in .env and load at runtime:
        $token = env('SERVICE_BEARER_TOKEN');

  - id: SECRET-007
    title: "Hardcoded database credentials in PHP"
    description: >
      Database connection credentials (host, username, password) appear to be
      hardcoded in PHP source rather than using Laravel's config/database.php
      with environment variables.
    severity: high
    category: Secrets
    enabled: true
    tags: [secrets, database, cwe-798]
    patterns:
      - type: regex
        target: php-files
        pattern: '(mysqli?_connect|new\s+PDO|new\s+mysqli)\s*\(\s*[''"]'
    remediation: |
      Use Laravel's database configuration instead of direct connections:
        $results = DB::select('SELECT * FROM users');
      Database credentials should be in .env, not PHP source.
    references:
      - https://cwe.mitre.org/data/definitions/798.html
